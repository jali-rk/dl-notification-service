databaseChangeLog:
  - changeSet:
      id: 003-01-delivery-outbox
      author: copilot
      changes:
        - createTable:
            tableName: delivery_outbox
            columns:
              - column: { name: id, type: BIGSERIAL, constraints: { primaryKey: true, primaryKeyName: pk_delivery_outbox } }
              - column: { name: notification_id, type: UUID, constraints: { nullable: false, unique: true } }
              - column: { name: channel, type: VARCHAR(20), constraints: { nullable: false } }
              - column: { name: status, type: VARCHAR(20), constraints: { nullable: false } }
              - column: { name: retry_count, type: INT, defaultValueNumeric: 0 }
              - column: { name: next_attempt_at, type: TIMESTAMP }
              - column: { name: error, type: TEXT }
        - createIndex:
            tableName: delivery_outbox
            indexName: idx_outbox_status_next
            columns:
              - column: { name: status }
              - column: { name: next_attempt_at }
        - createIndex:
            tableName: delivery_outbox
            indexName: idx_outbox_channel_status
            columns:
              - column: { name: channel }
              - column: { name: status }
